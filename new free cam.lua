local lplr  = game:GetService("Players").LocalPlayer
local cam = workspace.CurrentCamera
local uis = game:GetService("UserInputService")
local cumoffset = CFrame.new(-1.71440232, 18.2205505, 19.9237766, 0.999610126, -0.01872712, 0.0207117703, 9.31322686e-10, 0.741751373, 0.67067492, -0.0279227979, -0.670413435, 0.741462111)
local cumshot = Vector3.new()
local set = {}
set.track_character = true
set.full_brightness = false
set.free_cam = false


local savedlightprops = {}
local saveprops = {"Brightness", "Ambient", "OutdoorAmbient", "GlobalShadows", "FogEnd", "FogStart", "ColorShift_Bottom", "ColorShift_Top"}
local mouselock = true

local trackpart = Instance.new("Part")
local lightpart = Instance.new("Part", cam)

local uistuff = {}


spawn(function()
	while wait(3) do
		cam = workspace.CurrentCamera or workspace:FindFirstChild("Camera")
		lplr  = game:GetService("Players").LocalPlayer
		uis = game:GetService("UserInputService")
		trackpart.Parent = cam
		lightpart.Parent = cam
	end
end)

do
	
	local ui = Instance.new("ScreenGui")
	local OpenButton = Instance.new("TextButton")
	local Sets = Instance.new("ScrollingFrame")
	local ButtonExample = Instance.new("TextLabel")
	local opened = true
	
	ui.Name = "ui"
	if game.CreatorId == 0 then
		ui.Parent = game.Players.LocalPlayer:WaitForChild("PlayerGui")
	else
		ui.Parent = game.CoreGui
	end
	ui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	
	OpenButton.Name = "OpenButton"
	OpenButton.Parent = ui
	OpenButton.BackgroundColor3 = Color3.new(0, 0, 0)
	OpenButton.BackgroundTransparency = 1
	OpenButton.BorderSizePixel = 0
	OpenButton.Position = UDim2.new(0, 195, 0, -36)
	OpenButton.Size = UDim2.new(0, 40, 0, 36)
	OpenButton.ZIndex = 10
	OpenButton.Font = Enum.Font.SourceSans
	OpenButton.Text = "V"
	OpenButton.TextColor3 = Color3.new(1, 1, 1)
	OpenButton.TextScaled = true
	OpenButton.TextSize = 14
	OpenButton.TextWrapped = true
	
	Sets.Name = "Sets"
	Sets.Parent = OpenButton
	Sets.BackgroundColor3 = Color3.new(0.113725, 0.121569, 0.141176)
	Sets.BackgroundTransparency = 0.5
	Sets.Position = UDim2.new(0, 0, 1, 0)
	Sets.Size = UDim2.new(0, 321, 0, 37*3.1)
	
	ButtonExample.Name = "ButtonExample"
	ButtonExample.BackgroundColor3 = Color3.new(1, 1, 1)
	ButtonExample.BackgroundTransparency = 1
	ButtonExample.Size = UDim2.new(0, 236, 0, 37)
	ButtonExample.Font = Enum.Font.SourceSansBold
	ButtonExample.Text = "  Example"
	ButtonExample.TextColor3 = Color3.new(1, 1, 1)
	ButtonExample.TextSize = 30
	ButtonExample.TextWrapped = true
	ButtonExample.TextXAlignment = Enum.TextXAlignment.Left
	
	uistuff.ButtonExample = ButtonExample
	uistuff.Buttons = {}
	uistuff.freecam = function()
		if not set.free_cam == true then
			cumshot = Vector3.new()
			uis.MouseBehavior = Enum.MouseBehavior.Default
			pcall(function()
				lplr.Character.HumanoidRootPart.Anchored = false
			end)
		else
			cumoffset = cam.CFrame
		end
	end
	
	OpenButton.MouseButton1Click:Connect(function()
		if opened then
			opened = false
			for i = 1, 10 do
				Sets.Position = Sets.Position:Lerp(UDim2.new(0, 0, 0, -Sets.Size.Y.Offset), i/10)
				game:GetService("RunService").RenderStepped:Wait()
			end
		else
			opened = true
			for i = 1, 10 do
				Sets.Position = Sets.Position:Lerp(UDim2.new(0, 0, 1, 0), i/10)
				game:GetService("RunService").RenderStepped:Wait()
			end
		end
	end)
	
	uistuff.UpdateVars = function(what)
		
		for i, v in pairs(uistuff.Buttons) do
			
			if v[2] == "boolean" then
				local switch = v[3]
				if set[i] == true then
					switch.TextColor3 = Color3.new(0,1,0)
					switch.Text = "ON"
				else
					switch.TextColor3 = Color3.new(1,0,0)
					switch.Text = "OFF"
				end
			end
		end
		if what == "full_brightness" then
				
				if set.full_brightness == false then
					print("ffs")
					for i, v in pairs(savedlightprops) do
						game:GetService("Lighting")[i] = v
					end
					savedlightprops = {}
				else
					print("tru")
					local lg = game:GetService("Lighting")
					savedlightprops = {}
					
					for i, v in pairs(saveprops) do
						savedlightprops[v] = game:GetService("Lighting")[v]
					end
					lg.Ambient = Color3.new(1,1,1)
					lg.OutdoorAmbient= Color3.new(1,1,1)
					lg.Brightness = 4
					lg.GlobalShadows = false
					lg.FogStart = 0
					lg.FogEnd = 1e+10
					lg.ColorShift_Bottom = Color3.new(1,1,1)
					lg.ColorShift_Top = Color3.new(1,1,1)
					
				end
			elseif what == "free_cam" then
				uistuff.freecam()
			end
	end
	local count = 0
	
	for i,v  in pairs(set) do
		count = count +1
		btn = ButtonExample:Clone()
		btn.Text = "  "..i
		btn.Position = UDim2.new(0,0,0,btn.Size.Y.Offset*(count-1))
		btn.Parent = Sets
		if typeof(v) == "boolean" then
			local switch = Instance.new("TextButton")
			switch.Size = UDim2.new(0, Sets.Size.X.Offset-ButtonExample.Size.X.Offset, 1,0)
			switch.Position = UDim2.new(1, 0, 0, 0)
			switch.BackgroundTransparency = 1
			switch.Font = Enum.Font.SourceSansSemibold
			if v == true then
				switch.TextColor3 = Color3.new(0,1,0)
				switch.Text = "ON"
			else
				switch.TextColor3 = Color3.new(1,0,0)
				switch.Text = "OFF"
			end
			switch.TextSize = ButtonExample.TextSize
			switch.Parent = btn
			uistuff.Buttons[i] = {btn,"boolean", switch}
			
			switch.MouseButton1Click:Connect(function()
				if set[i] == true then
					set[i] = false
				else
					set[i] = true
				end
				uistuff.UpdateVars(i)
			end)
		end
		
		
	end
	
end

do
	trackpart.Anchored = true
	pcall(function()
		trackpart.CastShadow = false
	end)
	trackpart.CanCollide = false
	trackpart.BrickColor = BrickColor.White()
	trackpart.Material  = Enum.Material.SmoothPlastic
	trackpart.Parent = cam
	
	
	lightpart.Anchored = true
	lightpart.CanCollide = false
	lightpart.Size = Vector3.new(10,10,10)
	lightpart.Transparency = 1
	
	local light = Instance.new("PointLight", lightpart)
	light.Brightness=.3
	light.Shadows = false
	light.Range = 30
end





local function updatedirection(k)
	if k  == "a" or k == "w" or k == "d" or k == "s" or k == "r" or k == "e" then
			cumshot = Vector3.new()
			if uis:IsKeyDown(Enum.KeyCode.W) then
				cumshot = cumshot + Vector3.new(0, 0, -1)
			end
			
			if uis:IsKeyDown(Enum.KeyCode.A) then
				cumshot = cumshot + Vector3.new(-1, 0, 0)
			end
			
			if uis:IsKeyDown(Enum.KeyCode.S) then
				cumshot = cumshot + Vector3.new(0, 0, 1)
			end
			
			if uis:IsKeyDown(Enum.KeyCode.D) then
				cumshot = cumshot + Vector3.new(1, 0, 0)
			end
			
			if uis:IsKeyDown(Enum.KeyCode.E) then
				cumshot = cumshot + Vector3.new(0, 1, 0)
			end
			
			if uis:IsKeyDown(Enum.KeyCode.R) then
				cumshot = cumshot + Vector3.new(0, -1, 0)
			end
		end
end

lplr:GetMouse().KeyDown:Connect(function(k)
	if k == "k" and (game.CreatorId ==0 or uis:IsKeyDown(Enum.KeyCode.LeftControl) ) then
		if set.free_cam then
			set.free_cam = false
		else
			set.free_cam = true
		end
		uistuff.UpdateVars("free_cam")
	elseif k == "t" and uis:IsKeyDown(Enum.KeyCode.LeftControl) then
		if set.track_character == true then
			set.track_character = false
		else
			set.track_character = true
		end
		uistuff.UpdateVars("track_character")
	elseif k == "b" and uis:IsKeyDown(Enum.KeyCode.LeftControl) then
		--uistuff.UpdateBrightness()
	else
		updatedirection(k)
	end
end)
lplr:GetMouse().KeyUp:Connect(function(k)
	updatedirection(k)
end)
uis.InputBegan:Connect(function(inp, gg)
	if inp.UserInputType ==Enum.UserInputType.MouseButton3 then
		if mouselock then
			mouselock=false
		else
			mouselock=true
		end
	end
end)

uis.InputChanged:Connect(function(inp, gg)
	if set.free_cam and inp.UserInputType == Enum.UserInputType.MouseMovement then
		local xyz = Vector3.new(cumoffset:ToOrientation())
		local xrot = inp.Delta.Y/-250+xyz.X
		local nine = math.rad(89)
		xrot = math.clamp(xrot, -nine, nine)
		cumoffset = cumoffset*CFrame.Angles(-xyz.X, inp.Delta.X/-250, 0)*CFrame.Angles(xrot,0,0)
	end
end)

game:GetService("RunService"):BindToRenderStep("tempBinding", Enum.RenderPriority.Last.Value, function(dt)
	dt = math.min(1, dt)
	
	if set.free_cam then
		local speed = 45
		pcall(function()
			lplr.Character.HumanoidRootPart.Anchored = true
		end)
		if uis:IsKeyDown(Enum.KeyCode.LeftShift) then
			speed = 250
		elseif uis:IsKeyDown(Enum.KeyCode.LeftControl) then
			speed = 11
		end
		
		cumoffset =  (cumoffset * CFrame.new(cumshot*dt*speed))
		cam.CFrame = cumoffset
		if mouselock then
			uis.MouseBehavior = Enum.MouseBehavior.LockCenter
		else
			uis.MouseBehavior = Enum.MouseBehavior.Default
		end
		lightpart.CFrame = cam.CFrame
		if set.track_character and lplr.Character and lplr.Character:FindFirstChild("HumanoidRootPart") then
			local y = -cam.ViewportSize.Y/(8*70)
			local startpos = (cam.CFrame*CFrame.new(0, y, 0) ).p
			local d = startpos - lplr.Character.HumanoidRootPart.CFrame.p
			d = d.Magnitude
			
			trackpart.CFrame = CFrame.new( startpos, lplr.Character.HumanoidRootPart.CFrame.p)*CFrame.new(0, 0, -d/2)
			trackpart.Size = Vector3.new(.05, .05, d)
		else trackpart.CFrame =CFrame.new(0, math.huge, 0)
			
		end
	else
		trackpart.CFrame=CFrame.new(0, math.huge, 0)
		lightpart.CFrame = trackpart.CFrame
	end
	
end)

