names = {'Slab Block','Submersible','Four-Way','Elbow','Distributor','Pipe','Cap','Spawn Point','Distributor Cap','Fabricator','Reservoir','Upgrade Station','T-Junction','Arc Turret','Automechanic','Shield Generator',};
    attachments = {'FemaleFlange','FemaleFlange3','FemaleFlange1','FemaleFlange2','FemaleFlange4',};
    local cf = function(xp, yp, zp, xr, yr, zr)
    return cfn(xp, yp, zp)*cfa(xr,yr,zr)
end
cfn, cfa = CFrame.new, CFrame.fromEulerAnglesYXZ
local tbl = {{1,cf(-11.333,5.219,-2.666,0,3.142,-1.571),0,nil,nil,nil,nil},{2,cf(-12.483,5.609,-9.497,-0,3.142,-1.571),0,nil,nil,nil,nil},{3,cf(-0.8,-2.1,0,1.571,1.571,0),1,1,2,2,nil},{3,cf(0,-2.1,0.8,1.571,3.142,0),1,3,3,2,nil},{4,cf(-0.8,-1,0.575,0,-0,-1.571),1,3,4,4,nil},{3,cf(0.8,-2.1,-0,1.571,-1.571,0),1,3,5,2,nil},{5,cf(-1.308,0.409,1.017,-0,0,3.142),0,nil,nil,nil,nil},{6,cf(0,0,0,-0,0,0),2,7,6,1,4},{7,cf(-0.155,-0.4,0.58,-1.571,-0.262,0),1,5,4,nil,nil},{8,cf(8.902,-1.833,3.784,1.309,0,-0),0,nil,nil,nil,nil},{9,cf(-0.52,-0.4,0.3,-1.571,-1.047,0),1,1,10,nil,nil},{2,cf(-12.483,0.543,-14.179,-0,3.142,-1.571),0,nil,nil,nil,nil},{7,cf(0.58,-0.4,0.155,-1.571,1.309,0),1,5,6,nil,nil},{6,cf(0,0,0,-0,0,0),2,3,12,4,1},{2,cf(-12.483,10.483,-14.399,-0,3.142,-1.571),0,nil,nil,nil,nil},{6,cf(0,0,0,-0,0,0),2,15,3,1,5},{2,cf(-14.862,5.604,-9.559,-0,3.142,-1.571),0,nil,nil,nil,nil},{3,cf(-0.8,-2.1,0,1.571,1.571,0),1,1,17,2,nil},{3,cf(0,-2.1,0.8,1.571,3.142,0),1,3,18,2,nil},{6,cf(0,0,0,-0,0,0),2,4,19,4,4},{7,cf(0.155,-0.4,0.58,-1.571,0.262,0),1,3,19,nil,nil},{2,cf(-14.862,0.446,-14.049,-0,3.142,-1.571),0,nil,nil,nil,nil},{6,cf(0,0,0,-0,0,0),2,22,18,1,4},{10,cf(-11.083,-7.909,-0.362,-0,-3.142,-1.571),0,nil,nil,nil,nil},{9,cf(-0.58,-0.4,-0.155,-1.571,-1.833,0),1,1,24,nil,nil},{2,cf(-14.862,10.454,-14.253,-0,3.142,-1.571),0,nil,nil,nil,nil},{6,cf(0,0,0,-0,0,0),2,26,18,1,5},{10,cf(-11.083,-3.703,-0.42,-0,-3.142,-1.571),0,nil,nil,nil,nil},{9,cf(-0.58,-0.4,-0.155,-1.571,-1.833,0),1,1,28,nil,nil},{2,cf(-17.241,5.628,-9.393,-0,3.142,-1.571),0,nil,nil,nil,nil},{3,cf(-0.8,-2.1,0,1.571,1.571,0),1,1,30,2,nil},{3,cf(0,-2.1,0.8,1.571,3.142,0),1,3,31,2,nil},{2,cf(-17.241,0.307,-14.124,0,3.142,-1.571),0,nil,nil,nil,nil},{2,cf(-17.241,10.512,-13.951,0,3.142,-1.571),0,nil,nil,nil,nil},{6,cf(0,0,0,-0,0,0),2,33,31,1,4},{6,cf(0,0,0,-0,0,0),2,34,31,1,5},{7,cf(0.155,-0.4,0.58,-1.571,0.262,0),1,3,32,nil,nil},{6,cf(0,0,0,-0,0,0),2,32,19,5,5},{2,cf(-19.621,5.558,-9.606,0,3.142,-1.571),0,nil,nil,nil,nil},{3,cf(-0.8,-2.1,0,1.571,1.571,0),1,1,39,2,nil},{3,cf(0,-2.1,0.8,1.571,3.142,0),1,3,40,2,nil},{6,cf(0,0,0,-0,0,0),2,41,32,4,4},{7,cf(0,-0.4,0.6,-1.571,-0,0),1,3,41,nil,nil},{2,cf(-19.621,10.495,-14.045,-0,3.142,-1.571),0,nil,nil,nil,nil},{2,cf(-19.621,0.359,-13.962,-0,3.142,-1.571),0,nil,nil,nil,nil},{6,cf(0,0,0,-0,0,0),2,44,40,1,5},{6,cf(0,0,0,-0,0,0),2,45,40,1,4},{7,cf(-0.155,-0.4,0.58,-1.571,-0.262,0),1,5,41,nil,nil},{11,cf(-0.282,7.885,-3.52,-0,-1.571,1.571),0,nil,nil,nil,nil},{6,cf(12.983,10.895,-2.403,0,0,-1.571),3,49,1,nil,nil},{6,cf(10.142,10.736,4.995,-0,-1.571,-1.571),3,50,4,nil,nil},{12,cf(-0.438,15.431,5.567,1.309,3.142,3.142),0,nil,nil,nil,nil},{13,cf(-0.8,-1.4,0,0,0,-1.571),1,1,52,4,nil},{6,cf(0,0,0,-0,0,0),2,53,6,3,3},{6,cf(0,0,0,-0,0,0),2,53,51,2,4},{14,cf(-0.655,5.904,3.395,-1.571,3.142,0),0,nil,nil,nil,nil},{9,cf(-0.6,-0.4,0,-1.571,-1.571,0),1,1,56,nil,nil},{14,cf(-11.406,12.358,1.346,0,3.142,-1.571),0,nil,nil,nil,nil},{9,cf(-0.6,-0.4,0,-1.571,-1.571,0),1,1,58,nil,nil},{15,cf(-8.873,-5.854,4.025,1.309,0,0),0,nil,nil,nil,nil},{16,cf(-7.89,13.983,5.106,-1.309,-0,-3.142),0,nil,nil,nil,nil},{9,cf(-0.3,-0.4,0.52,-1.571,-0.524,0),1,1,61,nil,nil},}









--replace till this line
local remote = game:GetService("ReplicatedStorage").Shared.Remotes.PlaceStructure

local lplr = game:GetService('Players').LocalPlayer
local mouse = lplr:GetMouse()
mouse.Button1Down:Wait()
local base = mouse.Target

local placed = {}
local structures = workspace:WaitForChild('Structures')
local run = game:GetService('RunService')



local a, b = pcall(function()
	for i, v in ipairs(tbl) do
		run.RenderStepped:Wait()
		local name = names[v[1]]
		local placeMode = v[3]
		if placeMode == 0 then
			run.RenderStepped:Wait()
			remote:FireServer(
				name
				,{
					['BasePart'] = base;
					['CFrame'] = v[2]
				}
			)
		elseif placeMode == 1 then
			local needed = nil
			local s = os.clock()+2
			while needed == nil and os.clock()<s do
				for ii, vv in ipairs(placed) do
					print(ii, vv)
				end
				for ii, vv in ipairs(placed[v[5]]:GetDescendants()) do
					if vv:IsA('BasePart') and vv.Name == attachments[ v[4] ] then
						needed = vv
						break
					end
				end
				run.RenderStepped:Wait()
			end
			remote:FireServer(
				name
				,{
					['BasePart'] = needed ;
					['CFrame'] = v[2]
				}
				,attachments[ v[6] or v[4] ]
				,needed
			)
		elseif placeMode == 2 then
			local needed1 = nil
			local s = os.clock()+2
			local cf1, cf2 = v[4], v[5]
			local attach1, attach2 = v[6], v[7]
			while needed1 == nil and os.clock()<s do
				for ii, vv in ipairs(placed[cf1]:GetDescendants()) do
					if vv:IsA('BasePart') and vv.Name == attachments[ attach1 ] then
						needed1 = vv
						break
					end
				end
				run.RenderStepped:Wait()
			end
			local needed2 = nil
			local s = os.clock()+2
			while needed2 == nil and os.clock()<s do
				for ii, vv in ipairs(placed[cf2]:GetDescendants()) do
					if vv:IsA('BasePart') and vv.Name == attachments[ attach2 ] then
						needed2 = vv
						break
					end
				end
				run.RenderStepped:Wait()
			end
			remote:FireServer(
				name
				,{
					[1]={ ['CFrame'] = needed1 };
					[2]= { ['CFrame'] = needed2 };
				}
			)
		elseif placeMode == 3 then
			local needed1 = nil
			local s = os.clock()+2
			local cf, basepart, attahment = v[2] , v[4], v[5]
			local attach1
			while needed1 == nil and os.clock()<s do
				for ii, vv in ipairs(placed[basepart]:GetDescendants()) do
					if vv:IsA('BasePart') and vv.Name == attachments[ attahment ] then
						needed1 = vv
						break
					end
				end
				run.RenderStepped:Wait()
			end
			remote:FireServer(
				name
				,{
					[1]={ ['CFrame'] = needed1 };
					[2]= { ['CFrame'] = cf, BasePart = base };
				}
			)
		end
		local found, s = false, os.clock()+5
		local targetPos = (base.CFrame*v[2]).Position
		local con = structures.ChildAdded:Connect(function(model)
			if model.Name == name then
				local ss = os.clock()+2
				while ss>os.clock() and model.PrimaryPart == nil do run.RenderStepped:Wait() end
				local pp = model.PrimaryPart
				if pp then
					if (pp.CFrame.Position-targetPos).Magnitude<= ( placeMode == 0 and 40 or 40 ) then
						found = model
					end
				end
			end
		end)
		repeat run.RenderStepped:Wait() until found~=false or os.clock()>s
		con:Disconnect()
		if found then
			local targetPos = found:GetPivot().Position
			local found, s = false, os.clock()+60*5

			local con = structures.ChildAdded:Connect(function(model)
				if model.Name == name then
					local ss = os.clock()+2
					while ss>os.clock() and model.PrimaryPart == nil do run.RenderStepped:Wait() end
					local pp = model.PrimaryPart
					if pp then
						if (pp.CFrame.Position-targetPos).Magnitude<= ( placeMode == 0 and 20 or 20 ) then
							found = model
						end
					end
				end
			end)
			repeat run.RenderStepped:Wait() until found~=false or os.clock()>s
			con:Disconnect()
			if found then
				placed[i] = found
			end

		end

	end
end)

print(a, b)

