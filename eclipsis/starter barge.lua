names = {'Slab Block','Submersible','Standard Tank','T-Junction','Pipe','Distributor','Distributor Cap','Fabricator',};
    attachments = {'FemaleFlange','FemaleFlange2','FemaleFlange3','FemaleFlange1',};
    local cf = function(xp, yp, zp, xr, yr, zr)
    return cfn(xp, yp, zp)*cfa(xr,yr,zr)
end
cfn, cfa = CFrame.new, CFrame.fromEulerAnglesYXZ
local tbl = {{1,cf(-0.193,0.524,-13.846,1.571,3.142,0),0,nil,nil,nil,nil},{2,cf(-0.006,-6.82,-13.696,-0,-1.571,-1.571),0,nil,nil,nil,nil},{2,cf(0.121,-6.737,-11.317,-0,-1.571,-1.571),0,nil,nil,nil,nil},{2,cf(0.307,-6.773000000000001,-8.938,-0,-1.571,-1.571),0,nil,nil,nil,nil},{3,cf(3.438,1.949,-7.99,-0,-1.571,0),0,nil,nil,nil,nil},{4,cf(0,-1.4000000000000001,0.8,0,1.571,-1.571),1,1,5,2,nil},{4,cf(0.8,-2.1,-0,1.571,-1.571,0),1,1,4,3,nil},{4,cf(0.773,-2.1,-0.20700000000000002,1.571,-1.309,0),1,1,3,3,nil},{4,cf(0.8,-2.1,-0,1.571,-1.571,0),1,1,2,3,nil},{5,cf(0,0,0,-0,0,0),2,8,9,2,2},{5,cf(0,0,0,-0,0,0),2,8,7,4,4},{5,cf(0,0,0,-0,0,0),2,7,6,2,3},{6,cf(3.845,10.439,-7.894,0,1.571,0),0,nil,nil,nil,nil},{5,cf(0,0,0,-0,0,0),2,13,6,1,4},{7,cf(-0.6,-0.4,0,-1.571,-1.571,0),1,4,9,nil,nil},{8,cf(-3.091,1.549,-9.674,0,-3.142,0),0,nil,nil,nil,nil},{7,cf(-0.3,-0.4,-0.52,-1.571,-2.618,0),1,1,16,nil,nil},{8,cf(-3.1590000000000003,1.549,-2.0420000000000003,-0,0,-0),0,nil,nil,nil,nil},{7,cf(-0.3,-0.4,0.52,-1.571,-0.524,0),1,1,18,nil,nil},}


--replace till this line

local remote = game:GetService("ReplicatedStorage").Shared.Remotes.PlaceStructure

local lplr = game:GetService('Players').LocalPlayer
local mouse = lplr:GetMouse()
mouse.Button1Down:Wait()
local base = mouse.Target

local placed = {}
local structures = workspace:WaitForChild('Structures')
local run = game:GetService('RunService')



local areaRadius = base.Size.Magnitude+5
for i, v in ipairs(tbl) do
	areaRadius = math.max(areaRadius, v[2].Position.Magnitude)
end

areaRadius+=5

local p = Instance.new('Part', workspace.CurrentCamera)
p.Anchored = true
p.CanCollide = false
p.Material = Enum.Material.ForceField
p.Shape = Enum.PartType.Ball
p.Size = Vector3.new(2,2,2)*areaRadius
p.Color = Color3.new(1,.2, .2)
p.CFrame = CFrame.new(base.CFrame.Position)
local ppos = base.CFrame.Position
task.delay(60*8, function()
	game.Debris:AddItem(p, 1)
end) 


local a, b = pcall(function()
	for i, v in ipairs(tbl) do
		run.RenderStepped:Wait()
		local name = names[v[1]]
		local placeMode = v[3]
		if placeMode == 0 then
			run.RenderStepped:Wait()
			remote:FireServer(
				name
				,{
					['BasePart'] = base;
					['CFrame'] = v[2]
				}
			)
		elseif placeMode == 1 then
			local needed = nil
			local s = os.clock()+2
			while needed == nil and os.clock()<s do
				for ii, vv in ipairs(placed) do
					print(ii, vv)
				end
				for ii, vv in ipairs(placed[v[5]]:GetDescendants()) do
					if vv:IsA('BasePart') and vv.Name == attachments[ v[4] ] then
						needed = vv
						break
					end
				end
				run.RenderStepped:Wait()
			end
			remote:FireServer(
				name
				,{
					['BasePart'] = needed ;
					['CFrame'] = v[2]
				}
				,attachments[ v[6] or v[4] ]
				,needed
			)
		elseif placeMode == 2 then
			local needed1 = nil
			local s = os.clock()+2
			local cf1, cf2 = v[4], v[5]
			local attach1, attach2 = v[6], v[7]
			while needed1 == nil and os.clock()<s do
				for ii, vv in ipairs(placed[cf1]:GetDescendants()) do
					if vv:IsA('BasePart') and vv.Name == attachments[ attach1 ] then
						needed1 = vv
						break
					end
				end
				run.RenderStepped:Wait()
			end
			local needed2 = nil
			local s = os.clock()+2
			while needed2 == nil and os.clock()<s do
				for ii, vv in ipairs(placed[cf2]:GetDescendants()) do
					if vv:IsA('BasePart') and vv.Name == attachments[ attach2 ] then
						needed2 = vv
						break
					end
				end
				run.RenderStepped:Wait()
			end
			remote:FireServer(
				name
				,{
					[1]={ ['CFrame'] = needed1 };
					[2]= { ['CFrame'] = needed2 };
				}
			)
		elseif placeMode == 3 then
			local needed1 = nil
			local s = os.clock()+2
			local cf, basepart, attahment = v[2] , v[4], v[5]
			local attach1
			while needed1 == nil and os.clock()<s do
				for ii, vv in ipairs(placed[basepart]:GetDescendants()) do
					if vv:IsA('BasePart') and vv.Name == attachments[ attahment ] then
						needed1 = vv
						break
					end
				end
				run.RenderStepped:Wait()
			end
			remote:FireServer(
				name
				,{
					[1]={ ['CFrame'] = needed1 };
					[2]= { ['CFrame'] = cf, BasePart = base };
				}
			)
		end
		--if (model:GetPivot().Position-targetPos).Magnitude<= ( placeMode == 0 and 40 or 40 ) or (model:GetPivot().Position-base.Position).Magnitude <= areaRadius then
		local targetPos = (base.CFrame*v[2]).Position
		local found, s = false, os.clock()+60*5

		local con = structures.ChildAdded:Connect(function(model)
			if model.Name == name and not model:FindFirstChild('IsBlueprint') and not model:WaitForChild('IsBlueprint', .1) then
				
				local ss = os.clock()+2
				while ss>os.clock() and model.PrimaryPart == nil do run.RenderStepped:Wait() end
				if (model:GetPivot().Position-targetPos).Magnitude<= ( placeMode == 0 and 40 or 40 ) or (model:GetPivot().Position-ppos).Magnitude <= areaRadius then
					found = model
				end
			end
		end)
		repeat run.RenderStepped:Wait() until found~=false or os.clock()>s
		con:Disconnect()
		if found then
			placed[i] = found
		end
		
	end
end)

p:Destroy()

print(a, b)



