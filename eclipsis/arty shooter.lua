local lplr = game.Players.LocalPlayer

local mouse = lplr:GetMouse()
local function getDistance(pointA, pointB)
    return (pointA - pointB).magnitude
end


mouse.KeyDown:Connect(function(k)
    if k ~= 'v' then return end

    local seats = {}
    for i, arty in next, workspace.Structures:GetChildren() do
        if arty.Name ~= 'Artillery' then continue end
        local seat = arty.PanAssembly.ArtillerySeat
        
        local bar = arty.TiltAssembly.ProgressBar.Neon

        if bar.Mesh.Scale.Y<0.98 then continue end

        local dist = getDistance(seat.Position, lplr.Character.HumanoidRootPart.Position)
        if dist>19 then continue end
        table.insert(seats, {seat, dist})
    end

    table.sort(seats, function(a, b)
        return a[2]<b[2]
    end)

    seats[1][1]:Sit(lplr.Character.Humanoid)

    task.wait(.03)

    local args = {
        [1] = 2,
        [2] = 2,
        [3] = 2,
        [4] = 2,
        [5] = 2
    }

    seats[1][1].Parent.Parent.Remote:FireServer(unpack(args))
    game:GetService("ReplicatedStorage").Shared.Remotes.EffectMuzzleFlare:FireServer(seats[1][1].Parent.Parent)

    task.wait(.2)
    lplr.Character.Humanoid.Sit = false
end)