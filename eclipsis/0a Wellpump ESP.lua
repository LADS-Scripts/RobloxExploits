--[[
  [CTRL + Z] to toggle Wellpump ESP
]]

local plrs = game:GetService("Players");
local repst = game:GetService("ReplicatedStorage");
local uis = game:GetService("UserInputService");

repst:WaitForChild("Shared"):WaitForChild("MapComplete");
if workspace:FindFirstChild("WellContainer") then return end;

local lplr = game:GetService("Players").LocalPlayer;
local hl, container
local enabled = true;

uis.InputBegan:Connect(function(input, gameProcessedEvent)
  if gameProcessedEvent then return end

  if input.KeyCode == Enum.KeyCode.Z and uis:IsKeyDown(Enum.KeyCode.LeftControl) then
    enabled = not enabled;
    hl.Enabled = enabled;
  end
end)

local destroyClasses = {'Weld', 'WeldConstraint', 'ManualWeld', 'Motor6D'}

while true do
  hl = Instance.new("Highlight");
  container = Instance.new("Model");
  container.Parent = workspace;
  container.Name = "WellContainer";
  hl.Adornee = container;
  hl.Parent = container;

  for i, v in next, workspace:WaitForChild("Map"):GetChildren() do
    if i%30 == 0 then task.wait() end
    if v.Name == "Pipe1" and v:FindFirstChild("Pipe") and v.Pipe:FindFirstChild("WellTopFlange") then
      local clone = v:Clone();
      for _, bp in clone:GetDescendants() do
          if bp:IsA('BasePart') then
              bp.Anchored = true;
              bp.CanCollide = false;
              bp.CanQuery = false;
              bp.CanTouch = false;
              bp.Transparency = .75;
          elseif table.find(destroyClasses, bp.ClassName) then
              bp:Destroy();
          end
      end
      clone.Parent = container;
    end
  end
  task.wait(10);
end