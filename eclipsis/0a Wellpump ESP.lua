--[[
  [CTRL + B] to toggle Wellpump ESP
  [CTRL + H] to refresh
]]



local created = false;
local enabled = true;
local highlight;
local container;

local f = {};

function f.Toggle()
  if not created then
    return;
  end

  enabled = not enabled;
  f.CompareEnabled();
end

function f.CompareEnabled()
  highlight.Enabled = enabled;
  container.Parent = enabled and workspace or nil;
end

function f.Refresh()
  created = false;

  if highlight then
    highlight:Destroy();
  end

  if container then
    container:Destroy();
  end

  container = Instance.new("Model");
  container.Name = "WellContainer";

  highlight = Instance.new("Highlight");
  highlight.Adornee = container;
  highlight.Parent = container;

  for i, v in next, workspace:WaitForChild("Map"):GetChildren() do
    if i%20 == 0 then task.wait() end
    if v.Name == "Pipe1" and v:FindFirstChild("Pipe") and v.Pipe:FindFirstChild("WellTopFlange") then
      local clone = v:Clone();
      for _, bp:BasePart in clone:GetDescendants() do
          if bp:IsA('BasePart') then
              bp.Anchored = true;
              bp.CanCollide = false;
              bp.CanQuery = false;
              bp.CanTouch = false;
              bp:BreakJoints()
          end
      end
      clone.Parent = container;
    end
  end

  created = true;
  f.CompareEnabled();
end


local uis = game:GetService("UserInputService");
uis.InputBegan:Connect(function(input, gameProcessedEvent)
  if gameProcessedEvent then
    return;
  end

  if uis:IsKeyDown(Enum.KeyCode.LeftControl) then
    if input.KeyCode == Enum.KeyCode.B then
      f.Toggle();
    elseif input.KeyCode == Enum.KeyCode.H then
      f.Refresh();
    end
  end
end)

f.Refresh();