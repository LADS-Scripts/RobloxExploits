local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")

local parts = {}

local mouse = Players.LocalPlayer:GetMouse()


local materials = {Enum.Material.Plastic,Enum.Material.Wood,Enum.Material.Slate,Enum.Material.Concrete,Enum.Material.CorrodedMetal,Enum.Material.DiamondPlate,Enum.Material.Foil,Enum.Material.Grass,Enum.Material.Ice,Enum.Material.Marble,Enum.Material.Granite,Enum.Material.Brick,Enum.Material.Pebble,Enum.Material.Sand,Enum.Material.Fabric,Enum.Material.SmoothPlastic,Enum.Material.Metal,Enum.Material.WoodPlanks,Enum.Material.Cobblestone,Enum.Material.Air,Enum.Material.Water,Enum.Material.Rock,Enum.Material.Glacier,Enum.Material.Snow,Enum.Material.Sandstone,Enum.Material.Mud,Enum.Material.Basalt,Enum.Material.Ground,Enum.Material.CrackedLava,Enum.Material.Neon,Enum.Material.Glass,Enum.Material.Asphalt,Enum.Material.LeafyGrass,Enum.Material.Salt,Enum.Material.Limestone,Enum.Material.Pavement,Enum.Material.ForceField,Enum.Material.Cardboard,Enum.Material.Carpet,Enum.Material.CeramicTiles,Enum.Material.ClayRoofTiles,Enum.Material.RoofShingles,Enum.Material.Leather,Enum.Material.Plaster,Enum.Material.Rubber}

local saveCFrame = function(cf:CFrame)
	return string.format("{%.2f,%.2f,%.2f,%.2f,%.2f,%.2f}", cf.X, cf.Y, cf.Z, cf:ToOrientation())
end
local saveSize = function(v3:Vector3)
	return string.format("{%.2f,%.2f,%.2f}", v3.X, v3.Y, v3.Z)
end
local saveColor = function(col:Color3)
	return string.format("{%d,%d,%d}", col.R*255, col.G*255, col.B*255)
end
local saveMaterial = function(p:Part)
	return tostring(table.find(materials, p.Material))
end


mouse.KeyDown:Connect(function(key)
    if key == 'm' and UserInputService:IsKeyDown(Enum.KeyCode.LeftControl) then
        local res = 'return {'
        local first = true
        local i = 0
        for part:BasePart, _ in parts do
            i+=1
            if i%100==0 then task.wait(0) end
            if first then
                first = false
            else
                res..=','
            end
            local partString = '{'
            partString..=saveCFrame(part.CFrame)..','
            partString..=saveSize(part.Size)..','
            partString..=saveColor(part.Color)..','
            partString..=saveMaterial(part)..','
            partString..=tostring(part.Transparency)..','
            if part:IsA('MeshPart') then
                partString..=tonumber(part.MeshId:match("%d+"))..','
            end
            partString..='}'
            res..=partString
        end
        res..='}'
        setclipboard(res)
        print('saved')
    end
end)


while task.wait(3) do
    for i, part:BasePart in next, game:GetService("Workspace")["..."].Map:GetDescendants() do
        if i%1000 == 0 then task.wait() end
        if not part:IsA('BasePart') then continue end
        
        parts[part] = true
    end
    task.wait(1)
    local s = 0
    for i, v in parts do s+=1 end

    print('Parts recorded:', s)
end

